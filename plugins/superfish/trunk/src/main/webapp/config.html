<html> 
<head> 
    <link rel="stylesheet" href="/static/css/jquery-ui/redmond/jquery-ui.css" type="text/css" />

    <script src="/static/js/jquery.js" language="javascript"></script>
    <script src="/static/js/jquery.cookie.js" language="javascript"></script>
    <script src="/static/js/jquery-ui.js" language="javascript"></script>
    <script src="/static/js/jsonrpc.js" language="javascript"></script>
    <script src="/static/js/vosao.js" language="javascript"></script>
    <script src="/static/js/cms.js" language="javascript"></script>
    <script src="/static/js/back-services.js" language="javascript"></script>
 
    <link rel="stylesheet" href="/static/css/style.css" type="text/css" />
 
    <script src="/static/js/jquery.treeview.pack.js" type="text/javascript"></script>
    <link rel="stylesheet" href="/static/css/jquery.treeview.css" type="text/css" />
 
    <title>Superfish Vosao plugin config</title>
   
<script language="javascript">

var plugin = null;
var enabledPages = null;

$(function(){
    $("#tabs").tabs();
    Vosao.initJSONRpc(loadPlugin);
});

function loadTree() {
    Vosao.jsonrpc.pageService.getTree(function(r) {
        $('#tree').html(renderPage(r));
        $("#tree").treeview({
            animated: "fast",
            collapsed: true,
            unique: true,
            persist: "cookie",
            cookieId: "superfishTree"
        });
        $('#tree input').change(function() {
            enablePage(this.value, this.checked);
        });
    });
}

function renderPage(vo) {
    var pageUrl = encodeURIComponent(vo.entity.friendlyURL);
    var checked = '';
    if ($.inArray(vo.entity.friendlyURL, enabledPages) != -1) {
        checked = ' checked="checked"'
    }
    var html = '<li> <input type="checkbox" value="' + vo.entity.friendlyURL 
        + checked + '"/> ' + vo.entity.title;
    if (vo.children.list.length > 0) {
        html += '<ul>';
        $.each(vo.children.list, function(n, value) {
            html += renderPage(value);
        });
        html += '</ul>';
    }
    return html + '</li>';
}

function loadPlugin() {
	Vosao.jsonrpc.pluginService.getByName(function(r) {
	    plugin = r;
	    enabledPages = [];
	    if (plugin.configData) {
	        $.each(plugin.configData.split(','), function(i,value) {
		        enabledPages.push(value);
		    });
	    }
	    loadTree();		
	}, 'superfish');
}

function enablePage(page, enabled) {
	Vosao.jsonrpc.superfishBackService.enablePage(function(r) {
		Vosao.showServiceMessages(r);
	}, page, String(enabled));
}

</script>
   
</head>  
<body> 

<div id="topbar">

    <div id="leftmenu">
        <a href="/cms">Vosao</a> CMS
        <a href="/cms/pages.jsp">Content</a>
        <a href="/cms/templates.jsp">Templates</a>
        <a href="/cms/folders.jsp">Resources</a>
        <a href="/cms/config.jsp">Configuration</a>
        <a href="/cms/plugins">Plugins</a>
        <a href="/cms/plugins/config.jsp">Plugins config</a>
    </div>
    <div id="rightmenu">
        <a href="/cms/profile.jsp">Profile</a> 
        | <a href="#" onclick="onLogout()">Logout</a>
        | <a href="http://code.google.com/p/vosao/issues/list">Support</a>    
    </div>
    <span class="clear">&#160;</span>
</div>

<div id="wrapper">

<div id="tabs">
    <ul>
        <li><a href="#tab-1">Superfish plugin configuration</a></li>
    </ul>
    <div id="tab-1">
        <div id="tree"></div>
    </div>
</div>    
<div class="messages"> </div>

</div>
 
</body> 
 
</html> 